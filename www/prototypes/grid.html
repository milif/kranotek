<!DOCTYPE html>
<html>
  <head>
    <title>Prototype</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
  </head>
  <body style="background: url(background.png); ">
  
    <div class="container-fluid">
        <h1>Grid</h1>
        <div id="grid"></div>                  
    </div>
    <script id="require" type="text/javascript" src="../require.js"></script>
    <script>
        require('loader.js', function(){
            require(
                'view/Grid.js', 
                'view/button/Button.js', 
                'view/toolbar/Toolbar.js',
                'view/form/FieldText.js',                
                
                function(){
                
                    App.env = {
                        apiUrl: '.',
                        apiUrlSuffix: '.php'
                    }        
                    
                    App.defineModel('TestModel', {
                        api: 'test'
                    });
                    App.defineCollection('TestCollection',{
                        model: App.getModel('TestModel')
                    });
                    
                    var Grid = App.getView('Grid'),
                        Button = App.getView('Button'),
                        Toolbar = App.getView('Toolbar'),
                        FieldText = App.getView('FieldText'),
                        collection = new(App.getCollection('TestCollection'))(),
                        editButton = new Button({
                            disabled: true,
                            size: 'small',
                            icon: 'icon-edit'
                        }), 
                        removeButton = new Button({
                            disabled: true,
                            size: 'small',
                            icon: 'icon-remove',
                            click: function(){
                                var ids = grid.getSelection(),
                                    model = collection.get(ids[0]);
                                collection.remove([model], {silent: false});
                            }
                        }),
                        editorValue = new FieldText();
                        grid = new Grid({
                            collection: collection,
                            selectable: true,
                            columns: [
                                { key: 'key', name: 'Key', width: 100 },
                                { key: 'value', name: 'Value', width: 1, editor: editorValue },
                                { key: 'comment', name: 'Comment', width: 2}
                            ],
                            listeners: {
                                'selectionchange': function(id){
                                    var model = collection.get(id);
                                    if(model) {
                                        removeButton.enable();
                                        editButton.enable();
                                    } else {
                                        removeButton.disable();
                                        editButton.disable();
                                    }
                                }
                            }
                        });
                        
                        grid.getToolbar()
                            .add(editButton, 1)
                            .add(removeButton, 1);
                    
                        $('#grid').append(grid.$el);
                        grid.layout();
            });
        });
    </script>
    
    <style>
        #grid {
            background: white;
            margin-right: 100px;
            }
    </style>

  </body>
</html>
