<!DOCTYPE html>
<html>
  <head>
    <title>Prototype</title>
    <meta charset="utf-8">
    <!-- Bootstrap -->
    <link href="../vendor/bootstrap/css/bootstrap.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../vendor/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">  
        
    
    
  </head>
  <body style="background: url(background.png); ">
  
    <div class="container-fluid">
        <h1>Form</h1>
        <div id="form" style="background: white;"></div>             
    </div>
    
    <style>
        h1 .btn {
            margin-left: 15px;
            }
    </style>    
    
    <script id="require" type="text/javascript" src="../require.js"></script>
    <script>
        require('loader.js', function(){
            require(
                'RPC.js',
                'view/button/Button.js',
                'view/form/Form.js', 
                'view/form/FieldText.js',
                'view/form/FieldSelect.js',  
                'view/form/FieldCheckbox.js',         
                'view/form/FieldTextarea.js',
                'view/form/FieldTrigger.js',              
                
                function(){
                
                    App.env = {
                        apiUrl: '../',
                        apiUrlSuffix: '.php'
                    }
                    
                    
                    App.defineModel('ModelTest', {
                        api: 'class',
                        validateModel: function(attrs){
                            var errors = [],
                                attr;
                            
                            attr = attrs.text;
                            if(typeof attr !='undefined') {
                                if(attr.length < 4) {
                                    errors.push({ name: 'text', msg: 'Название 4 и более символов'});
                                }
                            }               
                            
                            return errors.length > 0 ? errors : null ;
                        },
                        toString: function(){
                            return this.get('Value');
                        }
                    });        
                    App.defineCollection('TestCollection', {
                        model: App.getModel('ModelTest')
                    });
                    
                    var Form = App.getView('Form'),
                        FieldTextarea = App.getView('FieldTextarea'),
                        FieldText = App.getView('FieldText'),
                        FieldSelect = App.getView('FieldSelect'),
                        FieldCheckbox = App.getView('FieldCheckbox'),
                        FieldTrigger = App.getView('FieldTrigger'),
                        Button = App.getView('Button'),
                        ModelTest = App.getModel('ModelTest'),
                        TestCollection = App.getCollection('TestCollection'),
                        collection = new TestCollection([
                            { 'Value': 'Option 1' },
                            { 'id': 123, 'Value': 'Option 2' }
                        ]),
                        model = new ModelTest({
                            'text': '',
                            'textarea': 'test2',
                            'select': 2,
                            'selectc': 123,
                            'checkbox': true,
                            'trigger': 'Trigger me'
                        }),
                        form = new Form({
                            legend: 'Legend',
                            model: model
                        })
                            .add(new FieldText({
                                label: 'Text field',
                                name: 'text'
                            }))
                            .add(
                                new FieldTrigger({
                                    label: 'Trigger field',
                                    name: 'trigger'
                                })
                                    .on('trigger', function(){
                                        this.setValue({
                                            value: 'Changed value',
                                            toString: function(){
                                                return this.value;
                                            }
                                        });
                                        App.msg.info({
                                            title: 'Значение поля изменено',
                                            text: 'Новое значение "Changed value"'
                                        });
                                    })
                            )
                            .add(new FieldTextarea({
                                label: 'Textarea field',
                                name: 'textarea'
                            }))
                            .add(new FieldSelect({
                                label: 'Select field',
                                name: 'select',
                                options: {
                                    1: 'Item 1',
                                    2: 'Item 2',
                                    3: 'Item 3'
                                }
                            }))
                            .add(new FieldSelect({
                                label: 'Select field (collection)',
                                name: 'selectc',
                                hasEmpty: true,
                                collection: collection
                            }))                            
                            .add(new FieldCheckbox({
                                label: 'Checkbox field',
                                name: 'checkbox'
                            }));
                    
                    $('#form').append(form.$el);
                    $('h1')
                        .append(new Button({
                            text: 'Сообщение об ошибке',
                            click: function(){
                                App.msg.alert({
                                    title: 'Ошибка при сохранении формы!', 
                                    text: 'Это тестовое сообщение. Сервис временно не доступен.'
                                });
                            }
                        }).$el);        
                
                
                }
            );
        });    
    </script>

  </body>
</html>
